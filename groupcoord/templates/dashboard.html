<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
  <style>
    body {
  font-family: 'Segoe UI', sans-serif;
  background-color: #e4f0f6;
  padding: 30px;
  color: #172b4d;
}

h2, h3 {
  font-weight: 600;
}

h2 {
  font-size: 30px;
  margin-bottom: 25px;
}

h3 {
  font-size: 22px;
  margin-top: 40px;
  margin-bottom: 20px;
  color: #0052cc;
}

form {
  background: #ffffff;
  padding: 24px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  max-width: 600px;
  margin-bottom: 40px;
}

input, select, textarea {
  padding: 10px;
  border-radius: 6px;
  border: 1px solid #dfe1e6;
  width: 100%;
  margin-bottom: 15px;
  font-size: 14px;
}

button {
  background-color: #0052cc;
  color: white;
  border: none;
  padding: 10px 16px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s ease;
}

button:hover {
  background-color: #0747a6;
}

.member-input-group {
  display: flex;
  gap: 10px;
  margin-bottom: 10px;
}

.member-input-group input {
  flex-grow: 1;
}

.members-list {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.member-chip {
  background-color: #deebff;
  color: #0747a6;
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 0.9em;
  display: flex;
  align-items: center;
  gap: 6px;
  animation: fadeIn 0.3s ease;
}

.member-chip span {
  cursor: pointer;
  font-weight: bold;
  color: #ff4d4d;
}

@keyframes fadeIn {
  from {
    transform: translateY(6px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.project-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 16px;
}

.project-card {
  position: relative;
  background-color: #ffffff;
  padding: 16px;
  border-radius: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}


.project-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.project-card a {
  text-decoration: none;
  color: #0052cc;
  font-weight: 600;
  font-size: 16px;
}

.project-progress {
  font-size: 14px;
  color: #5e6c84;
  margin-top: 6px;
}

.project-progress-container {
  margin-top: 10px;
}

.project-progress-label {
  font-size: 14px;
  color: #5e6c84;
  margin-bottom: 6px;
}

.project-progress-bar {
  background-color: #e1e4e8;
  height: 10px;
  border-radius: 6px;
  overflow: hidden;
}

.project-progress-fill {
  height: 100%;
  background-color: #4caf50;
  transition: width 0.4s ease;
}

.notification-badge {
  position: absolute;
  top: 10px;
  right: 12px;
  background-color: #ff4d4f;
  color: white;
  border-radius: 50%;
  font-size: 12px;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  box-shadow: 0 0 4px rgba(0, 0, 0, 0.2);
  z-index: 2;
}


    ul {
      list-style: none;
      padding: 0;
    }

    ul li {
      background-color: #e9ecef;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 10px;
    }

    ul li a {
      text-decoration: none;
      font-weight: bold;
      color: #007bff;
    }

    .center{
     /* margin: 0 auto;
     width: fit-content;
     text-align: center;  */

     margin: 0 auto;               
  width: 80%;                     
  max-width: 800px;               
  text-align: center;             
  padding: 20px; 
    }
  </style>
  {% load widget_tweaks %}
</head>
<body>

  <div class="center1">
    <h2>Welcome {{ request.user.username }}</h2>

    <h3>Create New Project</h3>
    <form method="post" id="project-form">
      {% csrf_token %}
      
      <!-- Display general form errors -->
      {% if form.errors %}
        <div style="color: red; margin-bottom: 15px; padding: 10px; background-color: #ffeeee; border-radius: 5px;">
          <strong>Please correct these errors:</strong>
          <ul>
            {% for field, errors in form.errors.items %}
              {% for error in errors %}
                <li>{{ field|title }}: {{ error }}</li>
              {% endfor %}
            {% endfor %}
          </ul>
        </div>
      {% endif %}
      
      <!-- Title Field -->
      <div style="margin-bottom: 15px;">
        {{ form.title.label_tag }}  
        {{ form.title }}
        {% if form.title.errors %}
          <div style="color: red; font-size: 0.9em; margin-top: 5px;">
            {% for error in form.title.errors %}
              {{ error }}<br>
            {% endfor %}
          </div>
        {% endif %}
      </div>
    
      <!-- Description Field -->
      <div style="margin-bottom: 15px;">
        {{ form.description.label_tag }}
        {{ form.description }}
        {% if form.description.errors %}
          <div style="color: red; font-size: 0.9em; margin-top: 5px;">
            {% for error in form.description.errors %}
              {{ error }}<br>
            {% endfor %}
          </div>
        {% endif %}
      </div>
    
      <!-- Due Date Field -->
      <div style="margin-bottom: 15px;">
        {{ form.due_date.label_tag }}
        {{ form.due_date|add_class:"date-input" }}
        {% if form.due_date.errors %}
          <div style="color: red; font-size: 0.9em; margin-top: 5px;">
            {% for error in form.due_date.errors %}
              {{ error }}<br>
            {% endfor %}
          </div>
        {% endif %}
      </div>
    
      <!-- Members Input -->
      <div style="margin-bottom: 15px;">
        <label>Invite Members (School Email)</label>
        <div class="member-input-group">
          <input type="email" id="member-email" placeholder="Enter school email (spu.ac.za)">
          <!-- <button type="button" id="add-member" title="Add Member">➕</button> -->
          <button type="button" id="add-member" title="Add Member" style="color: black;">➕</button>
  
        </div>
        <div id="members-list" class="members-list"></div>
        <input type="hidden" name="members_data" id="members-data">
      </div>
    
      <button type="submit" id="submit-btn">Create Project</button>
    </form>
  </div>
  

  <h3>Your Projects</h3>
  <div class="project-grid">
    {% for project in projects %}
      <div class="project-card">
        {% if project.has_notification %}
        <div class="notification-badge">!</div>
        {% endif %}
  
        <a href="{% url 'project_detail' project.id %}">{{ project.title }}</a>
        <div class="project-progress-container">
          <div class="project-progress-label">Progress: {{ project.progress|floatformat:0 }}%</div>
          <div class="project-progress-bar">
            <div class="project-progress-fill" style="width: {{ project.progress }}%;"></div>
          </div>
        </div>
      </div>
    {% empty %}
      <div class="project-card">
        No projects yet. Start by creating one!
      </div>
    {% endfor %}
  </div>
  

  <!-- JS for member adding -->
  <script>
const addBtn = document.getElementById('add-member');
const emailInput = document.getElementById('member-email');
const membersList = document.getElementById('members-list');
const membersDataInput = document.getElementById('members-data');
let memberEmails = [];

function isValidSchoolEmail(email) {
  return email.endsWith('@spu.ac.za'); // Replace with your actual domain
}

function updateHiddenInput() {
  membersDataInput.value = JSON.stringify(memberEmails); // Update the hidden input with the JSON string
}

function addMemberChip(email) {
  const chip = document.createElement('div');
  chip.className = 'member-chip';
  chip.innerHTML = `${email} <span onclick="removeChip(this, '${email}')">×</span>`;
  membersList.appendChild(chip);
}

function removeChip(element, email) {
  element.parentElement.remove();
  memberEmails = memberEmails.filter(e => e !== email);
  updateHiddenInput();
}

addBtn.addEventListener('click', (event) => {
  event.preventDefault(); // Prevent the form from submitting prematurely
  const email = emailInput.value.trim();
  if (email && isValidSchoolEmail(email) && !memberEmails.includes(email)) {
    memberEmails.push(email);
    addMemberChip(email);
    updateHiddenInput();
    emailInput.value = '';
  } else {
    alert("Enter a valid and unique school email like 12345678@spu.ac.za");
  }
});

  </script>
</body>
</html>
