<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Project Dashboard</title>
  <style>
    /* Resetting styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Arial', sans-serif;
      background-color: #f4f7fc;
      color: #333;
      padding: 20px;
    }

    /* Main container */
    .project-details {
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      max-width: 900px;
      margin: 0 auto;
      padding: 30px;
      overflow: hidden;
    }

    /* Title */
    h2 {
      font-size: 30px;
      color: #0052cc;
      margin-bottom: 20px;
    }

    /* General Text */
    p {
      font-size: 16px;
      color: #555;
      margin-bottom: 15px;
    }

    /* Task Section */
    h3 {
      font-size: 24px;
      margin-top: 30px;
      border-bottom: 2px solid #f0f0f0;
      padding-bottom: 10px;
    }

    button {
  background-color: #0052cc;
  color: white;
  border: none;
  padding: 10px 16px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s ease;
}

button:hover {
  background-color: #0747a6;
}

    .task-list {
      list-style: none;
      margin-top: 20px;
    }

    .task-list li {
      background-color: #f9f9fb;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
      font-size: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: transform 0.3s ease;
    }

    .task-list li.completed {
      background-color: #e1f7d5;
      text-decoration: line-through;
    }

    .task-status {
      font-size: 20px;
      margin-right: 20px;
      color: #28a745;
    }

    .task-actions button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 8px 12px;
      font-size: 14px;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .task-actions button:hover {
      background-color: #0056b3;
    }

    .task-list li:hover {
      transform: scale(1.02);
    }

    .file-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 20px;
  }

  .file-card {
    background-color: #ffffff;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    padding: 15px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .file-header {
    font-size: 16px;
    font-weight: bold;
    color: #333;
    margin-bottom: 10px;
  }

  .file-body {
    font-size: 14px;
    color: #555;
    margin-bottom: 15px;
  }

  .file-actions {
    display: flex;
    justify-content: space-between;
  }

  .view-btn, .download-btn {
    text-decoration: none;
    padding: 8px 12px;
    border-radius: 5px;
    font-size: 14px;
    font-weight: bold;
    color: white;
    transition: background-color 0.2s ease;
  }

  .view-btn {
    background-color: #007bff;
  }

  .view-btn:hover {
    background-color: #0056b3;
  }

  .download-btn {
    background-color: #28a745;
  }

  .download-btn:hover {
    background-color: #218838;
  }

    /* Form Sections */
    .form-section {
      margin-top: 40px;
    }

    .form-section h4 {
      font-size: 20px;
      color: #333;
      margin-bottom: 15px;
    }

    .completed-btn {
    background-color: #28a745;
    color: white;
    border: none;
    padding: 8px 12px;
    font-size: 14px;
    border-radius: 5px;
    cursor: not-allowed;
    display: flex;
    align-items: center;
    gap: 5px;
  }

  .progress-container{
    background-color: #28a745;
    color: white;
    /* border: none; */
    padding: 8px 12px;
    font-size: 14px;
    border-radius: 5px;
    /* cursor: not-allowed; */
    display: flex;
    align-items: center;
  }

  .progress-container p{
    color: #f0f0f0;
    font-weight: bold;
  }

  .completed-btn span {
    font-weight: bold;
  }
c
    form button {
      background-color: #0052cc;
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      border: none;
      font-size: 16px;
      cursor: pointer;
      margin-top: 15px;
      transition: background-color 0.2s ease;
    }

    form button:hover {
      background-color: #0747a6;
    }

    /* File List Section */
    .file-list {
      list-style: none;
      padding: 0;
      margin-top: 20px;
    }

    .file-list li {
      background-color: #f1f1f1;
      padding: 12px;
      border-radius: 8px;
      font-size: 14px;
      margin-bottom: 10px;
    }

    .form-section {
    margin-top: 40px;
    background-color: #ffffff;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    padding: 20px;
  }

  .form-section h4 {
    font-size: 20px;
    color: #333;
    margin-bottom: 15px;
  }

  /* File Input Container */
  .file-input-container {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
  }

  .file-input-container label {
    font-size: 14px;
    font-weight: bold;
    color: #555;
  }

  /* File Input Field */
  .file-input {
    padding: 10px;
    border: 1px solid #dfe1e6;
    border-radius: 6px;
    font-size: 14px;
    background-color: #f9f9fb;
    cursor: pointer;
    transition: border-color 0.2s ease;
  }

  .file-input:hover {
    border-color: #0052cc;
  }

  /* Upload Button */
  .upload-btn, .task-btn {
    background-color: #0052cc;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 6px;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .upload-btn:hover {
    background-color: #0747a6;
  }

  /* Input Fields */
  input[type="text"], input[type="date"], select {
    width: 100%;
    padding: 10px;
    border: 1px solid #dfe1e6;
    border-radius: 6px;
    font-size: 14px;
    background-color: #f9f9fb;
    margin-bottom: 15px;
    transition: border-color 0.2s ease;
  }

  input[type="text"]:focus, input[type="date"]:focus, select:focus {
    border-color: #0052cc;
    outline: none;
  }

  .member-input-group {
  display: flex;
  gap: 10px;
  margin-bottom: 10px;
}

.member-input-group input {
  flex-grow: 1;
}

.members-list {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.email{
  border-radius: 5px;
  border: 1px solid #dfe1e6;
  padding-left: 10px;
}

.member-chip {
  background-color: #deebff;
  color: #0747a6;
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 0.9em;
  display: flex;
  align-items: center;
  gap: 6px;
  animation: fadeIn 0.3s ease;
  margin-bottom: 10px;
}

.member-chip span {
  cursor: pointer;
  font-weight: bold;
  color: #ff4d4d;
}

    /* Back Button */
    .back-btn {
      background-color: #28a745;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 16px;
      margin-bottom: 20px;
      display: inline-block;
      text-decoration: none;
      transition: background-color 0.2s ease;
    }

    .back-btn:hover {
      background-color: #218838;
    }

    /* Responsiveness */
    @media (max-width: 768px) {
      .project-details {
        padding: 20px;
      }

      h2 {
        font-size: 26px;
      }

      p, .task-list li {
        font-size: 14px;
      }
    }
  </style>
  {% load widget_tweaks %}
</head>
<body>

  <!-- Back Button -->
  <a href="{% url 'dashboard' %}" class="back-btn">‚¨Ö Back to Dashboard</a>

  <div class="project-details">
    <h2>{{ project.title }}</h2>
    <p>Due: {{ project.due_date }}</p>
    <div class="progress-container">
      <p>Progress: {{ progress }}%</p>
    </div>

<h3>Tasks</h3>
<ul class="task-list">
  {% for task in tasks %}
    <li class="{% if task.completed %}completed{% endif %}">
      <span>{{ task.title }} - {{ task.assigned_to }} - Due {{ task.due_date }}</span>
      <span class="task-status">{% if task.completed %}‚úÖ{% else %}‚ùå{% endif %}</span>
      <div class="task-actions">
        {% if not task.completed %}
          <form method="post" style="display: inline;">
            {% csrf_token %}
            <input type="hidden" name="task_id" value="{{ task.id }}">
            <button type="submit" name="mark_complete" class="mark-complete-btn">
              Mark as Complete
            </button>
          </form>
        {% else %}
          <button class="completed-btn" disabled>
            <span>‚úî Completed</span> üîí
          </button>
        {% endif %}
      </div>
    </li>
  {% endfor %}
</ul>

<!-- Invite Members Section -->
<div class="form-section">
  <h4>Invite Members</h4>
  <form method="post" id="invite-member-form">
    {% csrf_token %}
    <div class="member-input-group">
      <input type="email" id="member-email" class="email" placeholder="Enter school email (spu.ac.za)">
      <button type="button" id="add-member" title="Add Member" style="color: white; font-weight: bold;">+</button>
    </div>
    <div id="members-list" class="members-list"></div>
    <input type="hidden" name="members_data" id="members-data">
    <button type="submit" name="invite_member_submit" class="task-btn">Invite Members</button>
  </form>
</div>

<!-- Task Form Section -->
<div class="form-section">
  <h4>Add Task</h4>
  <form method="post">
    {% csrf_token %}
    {{ task_form.as_p }}

    <!-- Dropdown for assigning the task to project members -->
     <!-- Dropdown for Assigning Tasks -->
<div style="margin-bottom: 15px;">
  <label for="id_assigned_to">Assign To</label>
  <select name="assigned_to" id="id_assigned_to">
    {% for member in project_members %}
      <option value="{{ member.id }}">{{ member.username }}</option>
    {% endfor %}
  </select>
</div>
    <button type="submit" name="task_submit" class="task-btn">Add Task</button>
  </form>
</div>

    <h3>Files</h3>
<div class="file-grid">
  {% for file in files %}
    <div class="file-card">
      <div class="file-header">
        <span class="file-name">{{ file.file.name|slice:":20" }}{% if file.file.name|length > 20 %}...{% endif %}</span>
      </div>
      <div class="file-body">
        <p>Uploaded by: {{ file.uploaded_by.username }}</p>
        <p>Uploaded on: {{ file.timestamp|date:"M d, Y H:i" }}</p>
      </div>
      <div class="file-actions">
        <a href="{{ file.file.url }}" target="_blank" class="view-btn">View</a>
        <a href="{{ file.file.url }}" download class="download-btn">Download</a>
      </div>
    </div>
  {% empty %}
    <p>No files uploaded yet.</p>
  {% endfor %}
</div>

    <!-- File Upload Form -->
    <div class="form-section">
      <h4>Upload File</h4>
      <form method="post" enctype="multipart/form-data" class="file-upload-form">
        {% csrf_token %}
        <div class="file-input-container">
          {{ file_form.file.label_tag }}
          {{ file_form.file|add_class:"file-input" }}
        </div>
        <button type="submit" name="file_submit" class="upload-btn">Upload File</button>
      </form>
    </div>

  <!-- JavaScript to handle task completion -->
  <script>
    document.querySelectorAll('.mark-complete-btn').forEach((button) => {
      button.addEventListener('click', function() {
        const taskItem = this.closest('li');
        taskItem.classList.toggle('completed');
        const status = taskItem.querySelector('.task-status');
        if (taskItem.classList.contains('completed')) {
          status.textContent = '‚úÖ';
        } else {
          status.textContent = '‚ùå';
        }
      });
    });
  </script>

<script>
  // Clear the task form after submission
  const taskForm = document.querySelector('form[method="post"]');
  taskForm.addEventListener('submit', function (event) {
    if (event.submitter.name === 'task_submit') {
      setTimeout(() => {
        taskForm.reset(); // Clear the form inputs
      }, 100); // Delay to ensure the form submission is processed
    }
  });
</script>

<script>
  const addBtn = document.getElementById('add-member');
  const emailInput = document.getElementById('member-email');
  const membersList = document.getElementById('members-list');
  const membersDataInput = document.getElementById('members-data');
  let memberEmails = [];
  
  function isValidSchoolEmail(email) {
    return email.endsWith('@spu.ac.za'); // Replace with your actual domain
  }
  
  function updateHiddenInput() {
    membersDataInput.value = JSON.stringify(memberEmails); // Update the hidden input with the JSON string
  }
  
  function addMemberChip(email) {
    const chip = document.createElement('div');
    chip.className = 'member-chip';
    chip.innerHTML = `${email} <span onclick="removeChip(this, '${email}')">√ó</span>`;
    membersList.appendChild(chip);
  }
  
  function removeChip(element, email) {
    element.parentElement.remove();
    memberEmails = memberEmails.filter(e => e !== email);
    updateHiddenInput();
  }
  
  addBtn.addEventListener('click', (event) => {
    event.preventDefault(); // Prevent the form from submitting prematurely
    const email = emailInput.value.trim();
    if (email && isValidSchoolEmail(email) && !memberEmails.includes(email)) {
      memberEmails.push(email);
      addMemberChip(email);
      updateHiddenInput();
      emailInput.value = '';
    } else {
      alert("Enter a valid and unique school email like 12345678@spu.ac.za");
    }
  });
  </script>

</body>
</html>
